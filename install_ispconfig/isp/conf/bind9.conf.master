// BIND9 configuration file for {HOSTNAME}
//
// WARNING: this file is generated by ISPConfig
//

// ORIGINAL FILE CONCEPT CREDIT TO:
// @(#)named.conf 02 OCT 2001 Rob Thomas robt@cymru.com
//
// Set up our ACLs
// NOTE: In BIND 8, ACL names with quotes were treated as different from
// the same name without quotes. In BIND 9, both are treated as the same.
acl "xfer" {
    localhost;

<!-- BEGIN DYNAMIC BLOCK: named_xfer -->
    {XFER};
<!-- END DYNAMIC BLOCK: named_xfer -->
//    none;   // Allow no transfers.  If we have other
            // name servers, place them here.
            // Note that in the Netherlands, for example,
            // the TLD servers 193.176.144.2, 194.53.253.100, and 193.176.144.128/28
            // are allowed to perform zone tranfers from the domains under .nl. The
            // RIPE NCC had requested in the past that reverse (in-addr.arpa) zones
            // permit zone transfer requests from 193.0.0.0/23.
};

acl "trusted" {
    // Place our internal and DMZ subnets in here so that
    // intranet and DMZ clients may send DNS queries.  This
    // also prevents outside hosts from using our name server
    // as a resolver for other domains.
    // 8.8.8.0/24;

<!-- BEGIN DYNAMIC BLOCK: named_trusted -->
    {TRUSTED};
<!-- END DYNAMIC BLOCK: named_trusted -->
    localhost; 
};

acl "bogon" {
    // Filter out the bogon networks.  These are networks
    // listed by IANA as test, RFC1918, Multicast, experi-
    // mental, etc.  If you see DNS queries or updates with
    // a source address within these networks, this is likely
    // of malicious origin. CAUTION: If you are using RFC1918
    // netblocks on your network, remove those netblocks from
    // this list of blackhole ACLs!
    0.0.0.0/8;
    1.0.0.0/8;
    2.0.0.0/8;
    5.0.0.0/8;
    7.0.0.0/8;
    10.0.0.0/8;
    23.0.0.0/8;
    27.0.0.0/8;
    31.0.0.0/8;
    36.0.0.0/8;
    37.0.0.0/8;
    39.0.0.0/8;
    42.0.0.0/8;
    49.0.0.0/8;
    50.0.0.0/8;
    77.0.0.0/8;
    78.0.0.0/8;
    79.0.0.0/8;
    92.0.0.0/8;
    93.0.0.0/8;
    94.0.0.0/8;
    95.0.0.0/8;
    96.0.0.0/8;
    97.0.0.0/8;
    98.0.0.0/8;
    99.0.0.0/8;
    100.0.0.0/8;
    101.0.0.0/8;
    102.0.0.0/8;
    103.0.0.0/8;
    104.0.0.0/8;
    105.0.0.0/8;
    106.0.0.0/8;
    107.0.0.0/8;
    108.0.0.0/8;
    109.0.0.0/8;
    110.0.0.0/8;
    111.0.0.0/8;
    112.0.0.0/8;
    113.0.0.0/8;
    114.0.0.0/8;
    115.0.0.0/8;
    116.0.0.0/8;
    117.0.0.0/8;
    118.0.0.0/8;
    119.0.0.0/8;
    120.0.0.0/8;
    121.0.0.0/8;
    122.0.0.0/8;
    123.0.0.0/8;
    169.254.0.0/16;
    172.16.0.0/12;
    173.0.0.0/8;
    174.0.0.0/8;
    175.0.0.0/8;
    176.0.0.0/8;
    177.0.0.0/8;
    178.0.0.0/8;
    179.0.0.0/8;
    180.0.0.0/8;
    181.0.0.0/8;
    182.0.0.0/8;
    183.0.0.0/8;
    184.0.0.0/8;
    185.0.0.0/8;
    186.0.0.0/8;
    187.0.0.0/8;
    192.0.2.0/24;
//    192.168.0.0/16;
    197.0.0.0/8;
    223.0.0.0/8;
    224.0.0.0/3;
};

logging {
      channel "default_syslog" {
            // Send most of the named messages to syslog.
            //syslog local2;
            //file "var/named/log/syslog.log";
            file "/var/log/syslog.log";
            severity debug; 
            print-time yes; 
      };
      channel audit_log {
            // Send the security related messages to a separate file.
            file "/var/log/named.log";
            //file "var/named/named.log";
            severity debug;
            print-time yes; 
      };
      category default { default_syslog; };
      category general { default_syslog; };
      category security { audit_log; default_syslog; };
      category config { default_syslog; };
      category resolver { audit_log; };
      category xfer-in { audit_log; };
      category xfer-out { audit_log; };
      category notify { audit_log; };
      category client { audit_log; };
      category network { audit_log; };
      category update { audit_log; };
      category queries { audit_log; };
      category lame-servers { audit_log; }; 
};

// Set options for security
options {

    pid-file "/var/named/chroot/var/run/named/named.pid"; // added from ispconfig
    directory "{BINDDIR}"; // added from ispconfig
    auth-nxdomain no; // added from ispconfig
    
    //directory "/var/named";
    dump-file "/var/named/data/cache_dump.db";
    statistics-file "/var/named/data/named_stats.txt";

    /*
     * If there is a firewall between you and nameservers you want
     * to talk to, you might need to uncomment the query-source
     * directive below.  Previous versions of BIND always asked
     * questions using port 53, but BIND 8.1 uses an unprivileged
     * port by default.
     */
     // query-source address * port 53;

    // Prevent DoS attacks by generating bogus zone transfer
    // requests.  This will result in slower updates to the
    // slave servers (e.g. they will await the poll interval
    // before checking for updates).
//    notify no;

    // Generate more efficient zone transfers.  This will place
    // multiple DNS records in a DNS message, instead of one per
    // DNS message.
    transfer-format many-answers;

    // Set the maximum zone transfer time to something more
    // reasonable.  In this case, we state that any zone transfer
    // that takes longer than 60 minutes is unlikely to ever
    // complete.  WARNING:  If you have very large zone files,
    // adjust this to fit your requirements.
    max-transfer-time-in 60;

    // We have no dynamic interfaces, so BIND shouldn't need to
    // poll for interface state {UP|DOWN}.
    interface-interval 0;

    allow-transfer {
        // Zone tranfers limited to members of the
        // "xfer" ACL.
        xfer;
    };
    allow-query {
        // Accept queries from our "trusted" ACL.  We will
        // allow anyone to query our master zones below.
        // This prevents us from becoming a free DNS server
        // to the masses.
        trusted;
    };
    blackhole {
        // Deny anything from the bogon networks as
        // detailed in the "bogon" ACL.
        bogon;
    };
};

// 
// a caching only nameserver config
// 
controls {
    inet 127.0.0.1 allow { localhost; } keys { rndckey; };
};


view "internal-in" in {
    // Our internal (trusted) view. We permit the internal networks
    // to freely access this view. We perform recursion for our
    // internal hosts, and retrieve data from the cache for them.

    match-clients { trusted; };
    recursion yes;
    additional-from-auth yes;
    additional-from-cache yes;

    zone "." IN {
        // Link in the root server hint file.
        type hint;
        file "named.ca";
    };
    zone "localdomain" IN {
        type master;
        file "named.localdomain";
        allow-update { none; };
    };
    zone "localhost" IN {
        type master;
        file "named.localhost";
        allow-update { none; };
    };

<!-- BEGIN DYNAMIC BLOCK: named_reverse_int -->
    zone "{INT_ZONE}.in-addr.arpa" {
        type master;
        file "pri.{INT_ZONE}.in-addr.arpa";
        allow-query { any; };
    };
<!-- END DYNAMIC BLOCK: named_reverse_int -->
<!-- BEGIN DYNAMIC BLOCK: named_int -->
    zone "{INT_DOMAIN}" {
        type master;
        file "int.{INT_DOMAIN}";
        allow-query { any; };
    };
<!-- END DYNAMIC BLOCK: named_int -->
    zone "0.0.127.in-addr.arpa" IN {
        // Allow queries for the 127/8 network, but not zone transfers.
        // Every name server, both slave and master, will be a master
        // for this zone.
        type master;
        //file "127.0.0.zone";
        file "named.local";
        //allow-update { none; };
        allow-query {
            any;
        };
        allow-transfer {
            none;
        };
    };
    zone "0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa" IN {
        type master;
        file "named.ip6.local";
        allow-update { none; };
    };
    zone "255.in-addr.arpa" IN {
        type master;
        file "named.broadcast";
        allow-update { none; };
    };
    zone "0.in-addr.arpa" IN {
        type master;
        file "named.zero";
        allow-update { none; };
    };
};

// Create a view for external DNS clients.
view "external-in" in {
    // Our external (untrusted) view. We permit any client to access
    // portions of this view. We do not perform recursion or cache
    // access for hosts using this view.

    match-clients { any; };
    recursion no;
    additional-from-auth no;
    additional-from-cache no;

    // Link in our zones
    zone "." in {
        type hint;
        file "named.ca";
    };
    zone "0.0.127.in-addr.arpa" {
        type master;
        //file "127.0.0.zone";
        file "named.local";
    };

<!-- BEGIN DYNAMIC BLOCK: named_reverse -->
    zone "{ZONE}.in-addr.arpa" {
        type master;
        file "pri.{ZONE}.in-addr.arpa";
        allow-query { any; };
    };
<!-- END DYNAMIC BLOCK: named_reverse -->
<!-- BEGIN DYNAMIC BLOCK: named -->
    zone "{DOMAIN}" {
        type master;
        file "pri.{DOMAIN}";
        allow-query { any; };
    };
<!-- END DYNAMIC BLOCK: named -->
<!-- BEGIN DYNAMIC BLOCK: named_slave -->
    zone "{DOMAIN}" {
        type slave;
        file "sec.{DOMAIN}";
        masters { {MASTERS}; };
    };
<!-- END DYNAMIC BLOCK: named_slave -->
    zone "0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa" IN {
        type master;
        file "named.ip6.local";
        allow-update { none; };
    };
    zone "255.in-addr.arpa" IN {
        type master;
        file "named.broadcast";
        allow-update { none; };
    };
    zone "0.in-addr.arpa" IN {
        type master;
        file "named.zero";
        allow-update { none; };
    };
};

// Create a view for all clients perusing the CHAOS class.
// We allow internal hosts to query our version number.
// This is a good idea from a support point of view.

view "external-chaos" chaos {
    match-clients { any; };
    recursion no;
    zone "." {
        type hint;
        file "db.null";
    };
    zone "bind" {
        type master;
        file "db.bind";
        allow-query {
            trusted;
        };
        allow-transfer {
            none;
        };
    }; 
}; 

include "/etc/rndc.key";


//// MAKE MANUAL ENTRIES BELOW THIS LINE! ////
